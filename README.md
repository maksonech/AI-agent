# AI-агент для анализа алертов

Система для автоматического анализа и обработки алертов с использованием GigaChat API.

## Основные возможности

- Анализ текстов алертов с выделением ключевой информации
- Поиск связанных API-эндпоинтов на основе содержимого алерта
- Интерактивное общение с GigaChat через консольный интерфейс
- Проверка статуса токенов GigaChat и управление лимитами

## Структура проекта

```
AI-agent/
├── config/                  # Конфигурационные файлы и модули
│   ├── __init__.py          # Инициализация модуля конфигурации
│   ├── credentials.py       # Управление учетными данными API
│   ├── exceptions.py        # Система обработки исключений
│   ├── logging_config.py    # Настройка логирования
│   ├── settings.py          # Управление настройками приложения
│   └── settings.json        # JSON-настройки приложения
├── data/                    # Данные для работы агента
│   ├── integration_endpoints.json  # Информация об API-эндпоинтах
│   └── architect_glossary.json     # Глоссарий терминов
├── docs/                    # Документация проекта
│   └── INTEGRATION_GUIDE.md # Руководство по интеграции
├── src/                     # Исходный код приложения
│   ├── alert_processing/    # Модули для обработки алертов
│   │   ├── __init__.py        # Инициализация модуля
│   │   ├── alert_formatter.py # Форматирование ответов по алертам
│   │   ├── alert_parser.py    # Парсинг и анализ текстов алертов
│   │   └── format_alert_response.py # Форматирование ответов
│   ├── core/                # Основные компоненты
│   │   ├── __init__.py        # Инициализация модуля
│   │   ├── agent.py           # Основная логика агента
│   │   ├── multithreaded.py   # Многопоточная обработка
│   │   ├── prompts.py         # Системные промпты для агента
│   │   └── utils.py           # Вспомогательные функции
│   ├── integrations/        # Интеграции с внешними системами
│   │   ├── __init__.py        # Инициализация модуля
│   │   └── bot_integration.py # Интеграция с мессенджерами
│   ├── logs/                # Директория для хранения логов
│   ├── tools/               # Инструменты для работы с данными
│   │   ├── __init__.py        # Инициализация модуля инструментов
│   │   ├── alert_tools.py     # Инструменты для работы с алертами
│   │   ├── api_tools.py       # Инструменты для работы с API
│   │   ├── gigachat_tools.py  # Инструменты для работы с GigaChat
│   │   ├── logging_utils.py   # Утилиты для логирования
│   │   └── tools.py           # Обратная совместимость с инструментами
│   ├── __init__.py          # Инициализация пакета src
│   └── cli.py               # Командный интерфейс
├── tests/                   # Тесты приложения
│   ├── debug/               # Отладочные скрипты
│   │   └── debug_commands.py  # Отладка команд бота
│   ├── fixtures/            # Тестовые данные и фикстуры
│   │   ├── multiple_alerts.txt  # Несколько алертов
│   │   ├── sample_alert.txt     # Пример алерта
│   │   └── three_alerts.txt     # Три алерта в одном файле
│   ├── unit/                # Модульные тесты
│   │   ├── test_custom_alert.py # Тесты пользовательских алертов
│   │   ├── test_file_analyzer.py # Тесты анализатора файлов
│   │   ├── test_alert.py      # Тесты анализа алертов
│   │   ├── test_alert_number.py # Тесты выбора алерта по номеру
│   │   ├── test_bot_response.py # Тесты ответов бота
│   │   ├── test_end_to_end.py # Сквозные тесты
│   │   └── test_gigachat_api.py # Тесты API GigaChat
│   └── __init__.py          # Инициализация пакета тестов
├── main.py                  # Точка входа в приложение
└── requirements.txt         # Зависимости проекта
```

## Ключевые улучшения

### 1. Модульная организация инструментов

Разделение large файла tools.py на логические модули:
- `alert_tools.py` - инструменты для анализа алертов
- `api_tools.py` - функциональность поиска API-эндпоинтов
- `gigachat_tools.py` - работа с токенами GigaChat
- `logging_utils.py` - утилиты для логирования

### 2. Централизованная конфигурация

Создан модуль для централизованного управления конфигурацией:
- Загрузка/сохранение настроек из JSON-файлов
- Управление путями к файлам
- Кэширование настроек для улучшения производительности
- Константы для часто используемых путей

### 3. Управление учетными данными API

Создан менеджер учетных данных для безопасного хранения и доступа:
- Загрузка данных из переменных окружения и файлов
- Централизованное управление учетными данными GigaChat
- Разделение конфигурации и чувствительных данных
- Поддержка различных провайдеров API

### 4. Централизованное логирование

Создана система для унифицированного логирования:
- Настройка логгеров для различных компонентов
- Ротация файлов логов
- Единый формат сообщений
- Специализированные логгеры для алертов, чата и инструментов

## Установка и запуск

1. Установите зависимости:
```
pip install -r requirements.txt
```

2. Создайте файл `.env` со следующими переменными:
```
GIGACHAT_API_CREDENTIALS=ваш_токен
GIGACHAT_API_SCOPE=GIGACHAT_API_PERS
```

3. Запустите приложение:
```
python main.py
```

## Команды для работы

- `файл` или `анализ файла алерта` - проанализировать файл с алертом
- `токены` или `проверить токены` - проверить статус токенов GigaChat
- `повторный анализ` - повторно проанализировать последний алерт
- `последний алерт` - получить информацию о последнем проанализированном алерте
- `exit` - выход из программы

## Система обработки исключений и многопоточная обработка

### Унифицированная обработка исключений

Приложение использует централизованную систему обработки исключений, которая:

- Определяет иерархию специализированных типов исключений для различных ситуаций
- Предоставляет декораторы для безопасного выполнения функций с обработкой ошибок
- Обеспечивает единообразное логирование и форматирование сообщений об ошибках
- Позволяет удобно обрабатывать ожидаемые и неожиданные исключения

Основные типы исключений:
- `AIAgentError` - базовый класс для всех исключений в приложении
- `ConfigError` - ошибки, связанные с конфигурацией
- `APIError` - ошибки при взаимодействии с внешними API
- `DataProcessingError` - ошибки обработки данных
- `FileOperationError` - ошибки при работе с файлами

Для обработки исключений можно использовать:
- Декоратор `@exception_handler` для функций
- Функцию `safe_execute()` для безопасного выполнения кода
- Функцию `format_exception()` для форматирования исключений в читаемый вид

### Многопоточный режим работы

Приложение поддерживает многопоточный режим для одновременного анализа нескольких алертов:

- Класс `AlertAnalyzeThread` для обработки алертов в отдельных потоках
- Функция `analyze_multiple_alerts()` для параллельного анализа нескольких файлов
- Функция `process_directory()` для обработки всех файлов в директории
- Возможность настройки количества одновременных потоков
- Функции обратного вызова для отслеживания прогресса

Для запуска многопоточного анализа можно использовать командный интерфейс:

```bash
python cli.py batch --dir tests/fixtures --threads 4
```

## Командный интерфейс

Приложение предоставляет удобный командный интерфейс для различных режимов работы:

```bash
# Запустить интерактивный режим
python cli.py interactive

# Проанализировать один файл алерта
python cli.py analyze --file tests/fixtures/sample_alert.txt

# Проанализировать все файлы в директории в многопоточном режиме
python cli.py batch --dir tests/fixtures --threads 4

# Проверить статус токенов GigaChat
python cli.py token-status
```

## Планы развития

- Добавление системы кэширования для уже проанализированных алертов
- Улучшение механизмов определения аномалий в алертах
- Реализация REST API для доступа к функциональности через HTTP
- Расширение возможностей агента с использованием инструментов LangChain
