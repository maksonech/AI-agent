# Инструкция по интеграции нового форматирования ответов бота

## Проблема
В настоящее время бот отображает исходный текст алерта в своих ответах, что делает их слишком длинными и перегруженными информацией.

## Решение
Мы создали модуль форматирования ответов, который позволяет отображать только нужную информацию без исходного текста алерта.

## Файлы решения
1. `Source/format_alert_response.py` - модуль с функциями форматирования ответа
2. `Source/bot_integration.py` - пример интеграции функций форматирования в бота

## Шаги по интеграции

### Шаг 1: Импортируйте функции форматирования
В коде бота добавьте импорт функций форматирования:

```python
from Source.alert_parser import get_data_alert
from Source.format_alert_response import format_alert_response, format_multiple_alerts
```

### Шаг 2: Используйте функцию форматирования вместо старого формата

#### Для одного алерта:
```python
# Получаем данные алерта
alert_data = get_data_alert(alert_text)

# Добавляем исходный текст в данные для форматирования (нужно даже если не будем его показывать)
alert_data['raw_text'] = alert_text

# Форматируем ответ БЕЗ исходного текста алерта
response = format_alert_response(alert_data, include_raw_text=False)

# Отправляем отформатированный ответ пользователю
send_message(response)
```

#### Для нескольких алертов:
```python
alerts_data = []
for alert_text in alerts_texts:
    alert_data = get_data_alert(alert_text)
    alert_data['raw_text'] = alert_text
    alerts_data.append(alert_data)

# Форматируем ответ для всех алертов
response = format_multiple_alerts(alerts_data, include_raw_text=False)

# Отправляем отформатированный ответ пользователю
send_message(response)
```

### Шаг 3: Проверьте все места вывода ответа
Убедитесь, что во всех местах, где формируется ответ с данными алерта, используется функция `format_alert_response` с параметром `include_raw_text=False`.

### Шаг 4: Удалите прямой вывод исходного текста
Если в коде бота есть места, где исходный текст алерта выводится напрямую (независимо от функции форматирования), удалите или закомментируйте этот код.

## Тестирование
После внесения изменений проверьте, что:
1. Бот по-прежнему корректно отображает всю необходимую информацию: ID, статус, сервис, время и т.д.
2. Исходный текст алерта больше не отображается в ответах бота

## Пример ожидаемого результата

### До изменений:
```
### Алерт #1

# Алерт ID: 250477683 - OPEN

**Сервис:** SmartNLP.SmartApp навыки ЦКР.SmartApp SkillFlow
**Тип:** Problem Status:P-250477683
**HTTP код:** Неизвестно
**Время:** 20:14 (MSK) 21.04.2025

**Исходный текст алерта:**
АС Рефлекс Stand: ПРОМ OPEN | Problem Status:P-250477683 | Уровень CUSTOM_ALERT CI05272529_skillflow_pod_failed for Environment Sber PROM2...
[Текст обрезан для краткости]
```

### После изменений:
```
### Алерт #1

# Алерт ID: 250477683 - OPEN

**Сервис:** SmartNLP.SmartApp навыки ЦКР.SmartApp SkillFlow
**Тип:** Problem Status:P-250477683
**HTTP код:** Неизвестно
**Время:** 20:14 (MSK) 21.04.2025
```

## Дополнительная информация
Если понадобится снова включить отображение исходного текста алерта, просто измените параметр `include_raw_text` на `True`. 